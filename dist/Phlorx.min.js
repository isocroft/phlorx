/*!
 * @projectname: Phlorx v0.0.2
 * @repo: https://www.github.com/isocroft/phlorxjs
 * @author(s): Okechukwu Ifeora
 * @contributor(s): -----------
 * @copyright: Copyright (c) 2016 @cdv
 * @license: MIT  
 * @releasedate: 12/01/2016
 *
 * Phlorx is a light-weight, task efficient, JavaScript library
 * for functional reactive programming inspired by Bacon.js &
 * React
 *
 * It requires jQuery to work properly
 */
 
window.Phlorx=function(n,t,i){var u="function";if(!t)throw new Error("Phlorx library cannot load -> jQuery dependeny missing");var e={}.hasOwnProperty,o=[].slice,r={},f=i(e,o,n);return t.fn.getStream=function(n){return new f(n,this)},t.fn.setAction=function(n,i){return $self=t(this),i.subscribe(function(t,i,r){$self.each(function(){n in $self&&$self[n](r)})}),!0},r.createUIStream=function(n,i){return t(n).getStream(i)},r.createWorkStream=function(n){return new f(n,{})},r.createBasicStream=function(n){return new f(n,{},!0)},r.interval=function(n,t){var i=this.createWorkStream(null),r;return r=setTimeout(function u(){i.fireAtCore(t),r=setTimeout(u,n)},n),i.filter(function(n){return Array.isArray(n)?n.length>0:!!n})},r.sequentially=function(n,t){var i=this.interval(n,t);return i.map(function(n){return n.shift()})},r.setAction=function(n,i,r){return t(n).setAction(typeof i==u?i(r):i,r)},r.fromPromise=function(n){var t=this.createWorkStream(null);if(typeof n.promise==u&&n.promise()===n)typeof n.then==u&&n.then(function(n){t.fireAtCore(n)},function(n){t.fireAtCore(n)});else throw new TypeError("first argument must be a standard promise object");return t},r}(this,this.jQuery,function(n,t,i){var u=null,e=!0,o="object",s="first argument must be a function",f="function",c="number",l="undefined",h="string";function y(n){var i=this;if(typeof n!=h)throw new TypeError("first argument nust be a string");var u=n,e=[],r=a(i),o=function(n,i,r){r&&typeof r!=l||i&&typeof i==c&&(r=i);var u=now=(new Date).getMilliseconds(),f;return function(){now=(new Date).getMillisecond(),f=now-u;var i=this;f>=r&&n.apply(i,t.call(arguments)),u=now}};return i.toString=function(){return"[object Stream]"},i.getEvent=function(){return u},i.getDelayFn=function(){return o},i.subscribe=function(n){return r.on(this.getEvent(),n,this)},i.unsubscribe=function(){return r.off(this.getEvent())},i.hasCoreEvent=function(){return r.has(this.getEvent())},i.fireAtCore=function(n){return r.emit(this.getEvent(),n)},i.queryQueue=function(n,t){if(typeof n==f)throw new Error(s);return n.call(t,e)},i.linkStream=function(n,t){n.subscribe.toString()==this.subscribe.toString()&&this.subscribe(function(i){var r=typeof t==f;n.fireAtCore(r?t(i):i)})},i}function r(n,t,r){var f,u,e;if(typeof t!=o||!("constructor"in t))throw new TypeError("second argument must be an object");return this.getProto=function(){return t},f=t.constructor,u=y.apply(this,[v(26)]),f===i.jQuery?t.each(function(){var i=f(this);i.on(""+n,function(n){u.fireAtCore(n)})}):r&&(e=u.subscribe||function(){},u.subscribe=function(t){e.call(this,t),this.fireAtCore(n)}),this.getStream=function(){return u},u}Object.keyExists=function(t,i){return!!t[i]&&n.call(t,i)},Array.filter=Array.filter||function(n,t,i){if(n instanceof Array||typeof t==f){var r,u=n,o=[];for(d=0;d<u.length;++d)r=u[d],t.call(i,r,d,u)===e&&o.push(r);return o}},Array.isArray=Array.isArray||function(n){return n&&n instanceof Array},Object.each=function(i,r,u){var s,h,a,l;if(i)if(typeof i==f)for(s in i)s!="prototype"&&s!="length"&&s!="name"&&(!i.hasOwnProperty||n.call(i,s))&&r.call(u,i[s],s,i);else if(Array.isArray(i)||i&&"length"in i&&typeof i.length==c)for(l=typeof i!=o,s=0,h=i.length;s<h;s++)(l||s in i)&&r.call(u,i[s],s,i);else if(i.forEach)i.forEach(function(){r.apply(this,t.call(arguments))},u);else{results={};for(s in i)i.hasOwnProperty(s)&&r.call(u,i[s],s,i)}return e};var a=function(){var n={},r=function(n){var t={};return Object.each(n,function(n){this[n.name]=n.result},t),t},i=function(n){return n.indexOf("->",0)>0?n.split("->",2):[]};return{emit:function(f){var o,h=-1,c=[],a,v={},p,y=t.call(arguments,1),s=!1;if(o=i(f),o.length?(f=o[0],o[0]=String(s),s=n[f]):(o.push([]),s=n[f]),s)while(h<s.length-1){if(h=h+1,a=s[h].name,!!o[0][0])if(o[1]===a)o[0]=e;else continue;if(c.unshift({result:s[h].fn.apply(s[h].cxt,y),name:a}),(c[0].result===u||typeof c[0].result==l)&&c.shift(),o[0]===e)break}return h=0,v[f]=c.length?r(c):u,v},on:function(t,i,r){var e,o=this,u=t.indexOf(":")>-1?t.split(":",2):t;if(typeof t==h&&typeof i==f)return t=typeof u==h?u:u[1],Object.keyExists(n,t)||(n[t]=[]),e=Array.isArray(u)?u[0]:""+n[t].length,n[t].push({name:e,cxt:r,fn:i,timestamp:+new Date}),n[t].sort(function(n,t){n.timestamp-t.timestamp}),o},once:function(){},has:function(t){return t?n.hasOwnProperty(t):!!t},poof:function(){n={}},emitList:function(n,t,r){var o={},e,u,f;if(Array.isArray(n))for(f=0;f<n.length;f++)u=n[f],e=i(u)[0]||u,o[e]=this.emit(u,t,r)[e];return},off:function(t,i){var r=[],f=this;return n[t]&&(i===u||typeof i==l?delete n[t]:(Array.filter(n[t],function(n,t){if(n&&n.name===i)return!!r.push(t)}),Object.each(r,function(n){this.splice(n,1)},n[t]))),f}}},v=function(n){return Math.round(Math.pow(30,n+1)-Math.random()*Math.pow(30,n)).toString(30).slice(1)};return r.prototype.filter=function(n){if(typeof n!=f)throw new TypeError(s);var i=this.getStream(),t=new r(u,{});return i.subscribe(function(i){n(i)&&t.fireAtCore(i)}),t},r.prototype.map=function(n){if(typeof n!=f)throw new TypeError(s);var i=this.getStream(),t=new r(u,{});return i.linkStream(t,n),t},r.prototype.mergeToNew=function(n){if(typeof n!=o||!(n instanceof r))throw new TypeError("first argument must be a [Stream] object");var f=this.getStream(),t=new r(u,{}),i=function(n){return function(t){this.queryQueue(function(n){n.push(t)}),n.fireAtCore(t)}};return f.subscribe(i(t)),n.subscribe(i(t)),t},r.prototype.flatMap=function(n){var i=function(n,t){return function(){t.apply(this,arguments).linkStream(n)}},f=this.getStream(),t=new r(u,{});return f.subscribe(i(t,n)),t},r.prototype.combineLatest=function(n,t){var i=this,r=i.mergeToNew(n);return r.subscribe(function(){var f=function(n){return Boolean(!!n[0])},e=function(n){return n.shift()};i.queryQueue(f)===n.queryQueue(f)&&t.apply(u,[i.queryQueue(e),n.queryQueue(e)])}),r},r.prototype.scan=function(n,t){var i=function(n){return function(i){return i=t,n(i)}};return this.map(i(n))},r.prototype.throttle=function(n){if(typeof n!=c)throw new TypeError("first argument must be a number");var u=this.getDelayFn(),i=this.getStream(),t=new r(i.getEvent(),{});return i.subscribe(u(function(){t.fireAtCore.apply(t,arguments)},n)),t},r})
