/*!
 * @projectname: Phlorx v0.0.2
 * @repo: https://www.github.com/isocroft/phlorxjs
 * @author(s): Okechukwu Ifeora
 * @contributor(s): none for now...
 * @copyright: Copyright (c) 2016 @cdv
 * @license: MIT  
 * @releasedate: 12/01/2016
 *
 * Phlorx is a light-weight, task efficient, JavaScript library
 * for functional reactive programming inspired by Bacon.js &
 * React
 *
 * It requires jQuery to work properly
 */
window.Phlorx=function(n,t,i){var u="function";if(!t)throw new Error("Phlorx library cannot load -> jQuery dependeny missing");var e={}.hasOwnProperty,o=[].slice,r={},f=i(e,o);return t.fn.getStream=function(n){return new f(n,this)},t.fn.setAction=function(n,i){return $self=t(this),i.subscribe(function(t,i,r){$self.each(function(){n in $self&&$self[n](r)})}),!0},r.createUIStream=function(n,i){return t(n).getStream(i)},r.createWorkStream=function(n){return new f(n,{})},r.createBasicStream=function(n){return new f(n,{},!0)},r.interval=function(n,t){var i=this.createWorkStream(null),r;return r=setTimeout(function u(){i.fireAtCore(t),r=setTimeout(u,n)},n),i.filter(function(n){return Array.isArray(n)?n.length>0:!!n})},r.sequentially=function(n,t){var i=this.interval(n,t);return i.map(function(n){return n.shift()})},r.setAction=function(n,i,r){return t(n).setAction(typeof i==u?i(r):i,r)},r.fromPromise=function(n){var t=this.createWorkStream(null);return typeof n.promise==u&&n.promise()===n&&typeof n.then==u&&n.then(function(n){t.fireAtCore(n)},function(n){t.fireAtCore(n)}),t},r}(this,this.jQuery,function(n){var i=null,u=!0,f="object",e="first argument must be a function",r="function",s="number",o="undefined",h="string";function a(n){var t=this;if(typeof n!=h)throw new TypeError("first argument nust be a string");var u=n,f=[],i=c(t),l=function(n,t,i){i&&typeof i!=o||t&&typeof t==s&&(i=t);var r=now=(new Date).getMilliseconds(),u;return function(){now=(new Date).getMillisecond(),u=now-r;var t=this;u>=i&&n.apply(t,[].slice.call(arguments)),r=now}};return t.toString=function(){return"[object Stream]"},t.getEvent=function(){return u},t.getDelayFn=function(){return l},t.subscribe=function(n){return i.on(this.getEvent(),n,this)},t.unsubscribe=function(){return i.off(this.getEvent())},t.hasCoreEvent=function(){return i.has(this.getEvent())},t.fireAtCore=function(n){return i.emit(this.getEvent(),n)},t.queryQueue=function(n,t){if(typeof n==r)throw new Error(e);return n.call(t,f)},t.linkStream=function(n,t){n.subscribe.toString()==this.subscribe.toString()&&this.subscribe(function(i){var u=typeof t==r;n.fireAtCore(u?t(i):i)})},t}function t(n,t,i){var u,r,e;if(typeof t!=f||!("constructor"in t))throw new TypeError("second argument must be an object");return this.getProto=function(){return t},u=t.constructor,r=a.apply(this,[l(26)]),u===w.jQuery?t.each(function(){var i=u(this);i.on(""+n,function(n){r.fireAtCore(n)})}):i&&(e=r.subscribe||function(){},r.subscribe=function(t){e.call(this,t),this.fireAtCore(n)}),this.getStream=function(){return r},r}Object.keyExists=function(t,i){return!!t[i]&&n.call(t,i)},Array.filter=Array.filter||function(n,t,i){if(n instanceof Array||typeof t==r){var f,e=n,o=[];for(d=0;d<e.length;++d)f=e[d],t.call(i,f,d,e)===u&&o.push(f);return o}},Array.isArray=Array.isArray||function(n){return n&&n instanceof Array},Object.each=function(t,i,e){var o,h,l,c;if(t)if(typeof t==r)for(o in t)o!="prototype"&&o!="length"&&o!="name"&&(!t.hasOwnProperty||n.call(t,o))&&i.call(e,t[o],o,t);else if(Array.isArray(t)||t&&"length"in t&&typeof t.length==s)for(c=typeof t!=f,o=0,h=t.length;o<h;o++)(c||o in t)&&i.call(e,t[o],o,t);else if(t.forEach)t.forEach(function(){i.apply(this,[].slice.call(arguments))},e);else{results={};for(o in t)t.hasOwnProperty(o)&&i.call(e,t[o],o,t)}return u};var c=function(){var n={},f=function(n){var t={};return Object.each(n,function(n){this[n.name]=n.result},t),t},t=function(n){return n.indexOf("->",0)>0?n.split("->",2):[]};return{emit:function(r){var e,h=-1,c=[],l,a={},y,v=[].slice.call(arguments,1),s=!1;if(e=t(r),e.length?(r=e[0],e[0]=String(s),s=n[r]):(e.push([]),s=n[r]),s)while(h<s.length-1){if(h=h+1,l=s[h].name,!!e[0][0])if(e[1]===l)e[0]=u;else continue;if(c.unshift({result:s[h].fn.apply(s[h].cxt,v),name:l}),(c[0].result===i||typeof c[0].result==o)&&c.shift(),e[0]===u)break}return h=0,a[r]=c.length?f(c):i,a},on:function(t,i,u){var e,o=this,f=t.indexOf(":")>-1?t.split(":",2):t;if(typeof t==h&&typeof i==r)return t=typeof f==h?f:f[1],Object.keyExists(n,t)||(n[t]=[]),e=Array.isArray(f)?f[0]:""+n[t].length,n[t].push({name:e,cxt:u,fn:i,timestamp:+new Date}),n[t].sort(function(n,t){n.timestamp-t.timestamp}),o},once:function(){},has:function(t){return t?n.hasOwnProperty(t):!!t},poof:function(){n={}},emitList:function(n,i,r){var o={},e,u,f;if(Array.isArray(n))for(f=0;f<n.length;f++)u=n[f],e=t(u)[0]||u,o[e]=this.emit(u,i,r)[e];return},off:function(t,r){var u=[],f=this;return n[t]&&(r===i||typeof r==o?delete n[t]:(Array.filter(n[t],function(n,t){if(n&&n.name===r)return!!u.push(t)}),Object.each(u,function(n){this.splice(n,1)},n[t]))),f}}},l=function(n){return Math.round(Math.pow(30,n+1)-Math.random()*Math.pow(30,n)).toString(30).slice(1)};return t.prototype.filter=function(n){if(typeof n!=r)throw new TypeError(e);var f=this.getStream(),u=new t(i,{});return f.subscribe(function(t){n(t)&&u.fireAtCore(t)}),u},t.prototype.map=function(n){if(typeof n!=r)throw new TypeError(e);var f=this.getStream(),u=new t(i,{});return f.linkStream(u,n),u},t.prototype.mergeToNew=function(n){if(typeof n!=f||!(n instanceof t))throw new TypeError("first argument must be a [Stream] object");var e=this.getStream(),r=new t(i,{}),u=function(n){return function(t){this.queryQueue(function(n){n.push(t)}),n.fireAtCore(t)}};return e.subscribe(u(r)),n.subscribe(u(r)),r},t.prototype.flatMap=function(n){var u=function(n,t){return function(){t.apply(this,arguments).linkStream(n)}},f=this.getStream(),r=new t(i,{});return f.subscribe(u(r,n)),r},t.prototype.combineLatest=function(n,t){var r=this,u=r.mergeToNew(n);return u.subscribe(function(){var f=function(n){return Boolean(!!n[0])},e=function(n){return n.shift()};r.queryQueue(f)===n.queryQueue(f)&&t.apply(i,[r.queryQueue(e),n.queryQueue(e)])}),u},t.prototype.scan=function(n,t){var i=function(n){return function(i){return i=t,n(i)}};return this.map(i(n))},t.prototype.throttle=function(n){if(typeof n!=s)throw new TypeError("first argument must be a number");var u=this.getDelayFn(),r=this.getStream(),i=new t(r.getEvent(),{});return r.subscribe(u(function(){i.fireAtCore.apply(i,arguments)},n)),i},t});
